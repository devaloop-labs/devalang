<div align="center">
    <img src="https://devalang.com/images/devalang-logo-min.png" alt="Devalang Logo" width="100" />
</div>

# Contributing to Devalang

Thanks for considering a contribution! This document explains how to set up your environment, build the project, and submit changes.

## Code of Conduct

By participating, you agree to follow our community standards: be respectful, constructive, and empathetic. If something goes wrong, please open an issue.

## Project structure

- `rust/`: Rust CLI, core engine, parser, preprocessor, audio runtime
- `typescript/`: TypeScript utilities and scripts
- `pkg/`: WASM package output (generated by wasm-pack)
- `examples/`: Devalang examples
- `docs/`: Documentation

## Prerequisites

- Rust (stable, edition 2024)
- Node.js 18+
- wasm-pack (if you work on the WASM package)

## Setup

1. Install dependencies

- Rust toolchain (<https://rustup.rs>)
- Node.js (<https://nodejs.org>)

1. Clone and install

- Clone this repository
- Run `npm install`

## Build and run

- Build (debug): `cargo build`
- Build (release): `cargo build --release`
- TypeScript compile: `npm run script:build`
- Development helpers:
	- `npm run rust:dev:build`  — build AST/audio once
	- `npm run rust:dev:check`  — syntax checks with debug logs
	- `npm run rust:dev:play`   — play audio in a loop (repeat) with debug
- WASM builds:
	- Web:  `npm run rust:wasm:web`
	- Node: `npm run rust:wasm:node`

## Tests and sanity checks

- Build and quick smoke test on examples:
	- `cargo build`
	- `npm run rust:dev:play`
- Prepublish (used by CI/release): `npm run prepublish`

## Versioning and releases

- Project version lives in multiple places:
	- `Cargo.toml`
	- `package.json`
	- `project-version.json` (includes build counter and last commit)
	- `pkg/package.json` (WASM package)
- Bump versions to the next pre-release (e.g. 0.0.1-alpha.16), then tag the repository:
    - Bump version: `npm run script:version:bump pre`
	- Commit bump:  `git commit -am "chore: bump version to 0.0.1-alpha.X"`
	- Create tag:   `git tag v0.0.1-alpha.X`
	- Push:         `git push && git push origin v0.0.1-alpha.X`
- CI publishes release artifacts on tags matching `v*`.

## Pull requests

- Keep PRs small and focused
- Describe the motivation and the approach
- Link related issues
- Add/update tests (when relevant)
- Keep the existing style; avoid mass reformatting

## Coding guidelines

- Rust: follow Clippy suggestions where practical; prefer small, focused modules
- Keep public APIs stable; document breaking changes in the changelog
- Add comments where behavior is non-obvious (parser and interpreter paths)

## Reporting issues

Please include:

- Version (`devalang --version`), OS, and repro steps
- Minimal code sample (`.deva`) if possible
- Expected vs. actual behavior

## Security

If you discover a vulnerability, please report it privately (<contact@devaloop.com>). Do not open a public issue until coordinated disclosure.

## Thanks

We appreciate your time and contributions — whether it’s code, docs, or feedback.
